function validate_parse(a,b){b=void 0===b?0:b;if(0!=b)if(b++,0==b&("("==a[0]&&")"==a[a.length-1]||"'"==a[0]&&"'"==a[a.length-1]))a=a.substring(1,a.length-1);else throw"Validation Rule Syntax Error: Invalid Stack Level";a=a.trim();rules=[];i=0;for(str_escape=!1;i<a.length;){switch(a[i]){case " ":case "\t":case "\n":case "\r":if(str_escape)break;0==b&&(rules.push(a.substring(0,i).trim()),a=a.substring(i+1).trim(),i=-1);break;case "(":if(str_escape)break;b++;break;case ")":if(str_escape)break;b--;0==
b&&(rules.push(a.substring(0,i+1).trim()),a=a.substring(i+1).trim(),i=-1);break;case "\\":a=(a.substring(0,i)+a.substring(i+1)).trim();break;case "'":(str_escape=!str_escape)?b++:b--}i++;if(0>b)throw"Validation Rule Syntax Error: Negative Stack Level";}a.length&&rules.push(a);if(b)throw"Validation Rule Syntax Error: Stack not empty";return rules.reverse()}
function validate_eval(a,b,c,e,f,h){c=void 0===c?!1:c;e=void 0===e?"":e;f=void 0===f?!1:f;h=void 0===h?"":h;var d=a.pop(),l=a.slice(0);switch(d){case "OR":d=validate_eval(a,b,c,e,f,h);var g=validate_eval(a,b,c,e,f,h);return d||g;case "AND":return d=validate_eval(a,b,c,e,f,h),g=validate_eval(a,b,c,e,f,h),d&&g;case "NOT":var k=!validate_eval(a,b,c);f!=!k&&c&&e&&validate_eval(l,b,c,e+" NOT",!f,h);return k;case "SET":try{validate_eval(a,b,c),k=!0}catch(n){k=!1}if(f!=!k&&c&&e)try{validate_eval(l,b,c,e+
" BE SET",f,h)}catch(n){}return k;case "EMPTY":try{var m=validate_eval(a,b,c);k=void 0==m||null==m||0==m||m==[]||0==m||""==m||"0"==m}catch(n){k=!0}if(f!=!k&&c&&e)try{validate_eval(l,b,c,e+" BE EMPTY",f,h)}catch(n){}return k;case "ERROR":return k=validate_eval(a,b,c,e,f,h),g=validate_eval(a,b,c,e,f,h),g||(validate_eval(l,b,c,e,f,h),validate_eval(l,b,c,e,f,k)),g;case "ANY":l=a.pop();l=validate_parse(l,-1);a=a.pop();a=validate_parse(a,-1);for(g=!1;a.length;)a=a.concat(l),g|=validate_eval(a,b,c,e,f,h);
return g;case "ALL":l=a.pop();l=validate_parse(l,-1);a=a.pop();a=validate_parse(a,-1);for(g=!0;a.length;)a=a.concat(l),g&=validate_eval(a,b,c,e,f,h);return g;case "MATCH":return d=validate_eval(a,b),d=new RegExp(d),g=validate_eval(a,b,c),g=d.test(g),f!=!g&&c&&e&&(validate_eval(l,b,c,e+" MATCH PATTERN: "+d,f,h),validate_eval(l,b,c,e+" MATCH PATTERN: "+d,f,h)),g;case "BETWEEN":return d=validate_eval(a,b,c),g=validate_eval(a,b,c),a=validate_eval(a,b,c),k=d<=a&&a<=g,f!=!k&&c&&e&&(validate_eval(l,b,c,
a+" "+e+" BE BETWEEN "+d+" AND "+g,f,h),validate_eval(l,b,c,a+" "+e+" BE BETWEEN "+d+" AND "+g,f,h),validate_eval(l,b,c,a+" "+e+" BE BETWEEN "+d+" AND "+g,f,h)),k;case ">":return d=validate_eval(a,b,c),g=validate_eval(a,b,c),k=d>g,f!=!k&&c&&e&&(validate_eval(l,b,c,d+" "+e+" BE GREATOR THAN "+g,f,h),validate_eval(l,b,c,d+" "+e+" BE GREATOR THAN "+g,f,h)),k;case "<":return d=validate_eval(a,b,c),g=validate_eval(a,b,c),k=d<g,f!=!k&&c&&e&&(validate_eval(l,b,c,d+" "+e+" BE LESS THAN "+g,f,h),validate_eval(l,
b,c,d+" "+e+" BE LESS THAN "+g,f,h)),k;case "==":return d=validate_eval(a,b,c),g=validate_eval(a,b,c),k=d==g,f!=!k&&c&&e&&(validate_eval(l,b,c,d+" "+e+" BE EQUAL TO "+g,f,h),validate_eval(l,b,c,d+" "+e+" BE EQUAL TO "+g,f,h)),k;case ">=":return d=validate_eval(a,b,c),g=validate_eval(a,b,c),k=d>=g,f!=!k&&c&&e&&(validate_eval(l,b,c,d+" "+e+" BE GREATOR THAN OR EQUAL TO "+g,f,h),validate_eval(l,b,c,d+" "+e+" BE GREATOR THAN OR EQUAL TO "+g,f,h)),k;case "<=":return d=validate_eval(a,b,c),g=validate_eval(a,
b,c),k=d<=g,f!=!k&&c&&e&&(validate_eval(l,b,c,d+" "+e+" BE LESS THAN OR EQUAL TO "+g,f,h),validate_eval(l,b,c,d+" "+e+" BE LESS THAN OR EQUAL TO "+g,f,h)),k;case "SUM":a=a.pop();for(a=validate_parse(a,-1);a;)g+=validate_eval(a,b,c,e?"TOTAL "+e:"",f,h);return g;case "+":return d=validate_eval(a,b,c,e?"TOTAL "+e:"",f,h),g=validate_eval(a,b,c,e?"TOTAL "+e:"",f,h),d+g;case "-":return d=validate_eval(a,b,c,e?"DIFFERENCE "+e:"",f,h),g=validate_eval(a,b,c,e?"DIFFERENCE "+e:"",f,h),d-g;case "*":return d=
validate_eval(a,b,c,e?"PRODUCT "+e:"",f,h),g=validate_eval(a,b,c,e?"PRODUCT "+e:"",f,h),d*g;case "/":return d=validate_eval(a,b,c,e?"QUOTENT "+e:"",f,h),g=validate_eval(a,b,c,e?"QUOTENT "+e:"",f,h),d/g;case "%":return d=validate_eval(a,b,c,e?"QUOTENT "+e:"",f,h),g=validate_eval(a,b,c,e?"QUOTENT "+e:"",f,h),d%g;case "**":return d=validate_eval(a,b,c,e?"POWER "+e:"",f,h),g=validate_eval(a,b,c,e?"POWER "+e:"",f,h),k=Math.pow(d,g);default:if(!isNaN(d))return d;if("'"==d[0]&&"'"==d[d.length-1])return k=
d.substring(1,d.length-1);if("("==d[0]&&")"==d[d.length-1])return d=validate_parse(d,-1),k=validate_eval(d,b,c,e,f,h);if(d in b){if(c){if("type"in b[d])switch(h?b[d].setCustomValidity(h):b[d].setCustomValidity(e),b[d].type){case "checkbox":k=b[d].checked;if(!k)throw"Checkbox not set: "+d;break;default:k=b[d].value}else if(b[d]instanceof RadioNodeList){k=!1;for(c=0;c<b[d].length;c++)k|=b[d][c].checked,h?b[d][c].setCustomValidity(h):b[d][c].setCustomValidity(e);if(!k)throw"Radio not set: "+d;k=b[d].value}else k=
b[d].value,h?b[d].setCustomValidity(h):b[d].setCustomValidity(e);return k}return b[d]}throw"Validate could not process: "+d;}}function validate(a,b,c,e){c=void 0===c?!0:c;e=void 0===e?!0:e;var f=!0;for(a=validate_parse(a);a.length&&f;){var h=a.slice(0);f&=validate_eval(a,b,c);!f&&c&&e&&validate_eval(h,b,c,"MUST")}return f};
